# What is This

I learn a new tech stack (golang). After some familiarity with the language, it's necessary to understand how to make a typical project:
- project structure and wiring
- how to deal with (libraries and practices):
  - http/grpc
  - relational DBs and migrations
  - kafka
  - logging (contextual logging would be nice)
  - metrics
  - tracing
  - testing
- prepare an application for deployment (here it's just locally)

p.s. I use libraries that I've heard about or that have more recommendations on a random Reddit post from unknown people. For example, https://awesome-go.com has so many HTTP libraries that it's impossible to go through all of them.

# Application 

## Short Description
The application helps to book a meeting room. 

## Auditory
- Meeting organisation software

## User cases
| #  | UserStory   | Importance   |
|-------------- | -------------- | -------------- |
| 1    | As a user, I want to get a list of meeting rooms with their attributes and timetable     | High     |
| 2    | As a user, I want to filter a list of meeting rooms by their attributes     | Low     |
| 3    | As a user, I want to book a free meeting room at certain time interval     | High     |
| 4    | As a user, I want to cancel a booking     | High     |
| 5    | As a user, I want to check a meeting room timetable near it     | Medium     |
| 6    | As an owner of meeting rooms, I want to CRUD meeting rooms     | High     |
| 7    | As an owner of meeting rooms, I want users to confirm a booking when they enter the corresponding meeting room     | Medium     |
| 8    | As an owner of meeting rooms, I want to know the history of booking events and analyze it     | High     |
| 9    | As an owner of meeting rooms, I want to give some users a priority - they can reassign a certain meeting room if it's booked by a person with lower priority    | Medium     |
| 10    | As an owner of meeting rooms, I want to lock/unlock a meeting room in a case of emergency. Locked room os automatically cancels current booking   | Medium     |
| 11    | As a user, I want to be notified if my booking is canceled   | Medium     |
| 12    | As an owner of meeting rooms, I want to display on a pad next to a meeting room door info about the current meeting with an image generated by AI according to the agenda   | Medium     |

User stories with high importance shoud be enough. It can be updated later.

p.s. Users here are a mix of humans and other softwares. It's for simplicity because the main purpose of the project is tech learning.

## Technical Design

- HTTP API for US1, US3, US4, US6, 
- gRPC API for US1, US3, US4, US6 with the same logic as HTTP API
- Authorisation for US6. Assumption that organisation has autentication and authorization services.
- US1, US3, US4 without authorization - first of all, it doesn't add anything to studying and also it would be mocked anyway without real integration counterparties.
- Postgresql is a storage for meeting rooms info and timetables
- History events are sinked into Kafka - assumption that there is a DWH consumer
- It's hard to imagine 100k+ meeting rooms. And their data change rarely. The most volatile part of data is timetables. There are no requirements to keep bookings of the past, so it's possible to delete them and free some space.
- There are no logic linked to meeting rooms attributes. No need in semantic. To keep simple, an attribute is a string.
- Booking info contains a meeting host, a meeting room, start, end, date of booking, attendees, agenda.

Why postgres and kafka? They are very popular and I have experience with both of them. 

# What implemented
- There is only room management API: create, update, list, delete. 
- Application has configuration in `config/$env/`. 
- Application has DB migrations via tern in `migrations/` directory,
- Structured logging. But there are 2 libraries. Either need to figure out how to use zap as a server logging or try another http library (chi looks poor).

## How to run
- Run postgresql
- Update conf/local/application.toml
- Run from source code
  ```bash
  tern migrate
  go run cmd/main.go -- /path/to/config/file
  ```

# Questions for the Future

## Go
- ~~How to cancel a task running in a gorutine?~~ context
- is it possible to have strict deserialization of json? Absent field is an error, not a default value.
- Is there a reliable way to deal with nil dependencies? Or how to get compile errors for missed fields in a struct?

## Chi 
- Why 405 instead of 404
- Is it possible to use other logging libraries? For example, zap.
- How to log responses? Do I need to write my own middleware?
- How to mask headers? For example session token
- Quite odd decision to use mutable Router and inject it in different APIs, instead of combining Routers constructed in different APIs. Wiring looks clumsy.

## Logging
- How to mask fields of structures?
- How to add some constant fields to all logs?
- How to have different logging configs? For local, test, prod envs.

## Testing
- How to write test description as a normal long sentence instead of a camel case function name?
- how to separate test files from main code

## IDE
- How to implement all functions of an interface for a structure